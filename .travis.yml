language: java
sudo: true
addons:
  apt:
    packages:
    - oracle-java8-installer
    - nodejs
install:
- wget -c https://archive.apache.org/dist/jmeter/binaries/apache-jmeter-2.13.tgz
- tar -xf apache-jmeter-2.13.tgz
- wget -P ./apache-jmeter-2.13/lib/ext https://github.com/ralfstx/minimal-json/releases/download/0.9.4/minimal-json-0.9.4.jar
- wget -P ./apache-jmeter-2.13/lib/ext https://github.com/ralfstx/minimal-json/releases/download/0.9.4/minimal-json-0.9.4-sources.jar
- wget -P ./apache-jmeter-2.13/lib/ext https://github.com/ralfstx/minimal-json/releases/download/0.9.4/minimal-json-0.9.4-javadoc.jar
- wget -P ./apache-jmeter-2.13/lib/ext https://github.com/maciejzaleski/JMeter-WebSocketSampler/releases/download/version-1.0.2/JMeterWebSocketSampler-1.0.2-SNAPSHOT.jar
- wget -c https://github.com/MCS-Lite/mcs-lite-app/releases/download/v1.0.6/7688.tar.gz
- tar -zxf 7688.tar.gz && cd 7688
- node server.js&
- cd .. && pwd
before_script:
- ls -al
- cp $TRAVIS_BUILD_DIR/apache-jmeter-2.13/extras/ant-jmeter-1.1.1.jar ./
- cp $TRAVIS_BUILD_DIR/apache-jmeter-2.13/extras/collapse.png ./
- cp $TRAVIS_BUILD_DIR/apache-jmeter-2.13/extras/expand.png ./
- ls -al
branches:
  only:
  - master
  - feature/auto-build
script:
- jdk_switcher use oraclejdk8
- ant -buildfile build.xml -Dtestpath=./ -Dtest=SmokeTest_lite -Djmeter.home="$TRAVIS_BUILD_DIR/apache-jmeter-2.13"
  -Dmcslite.host="localhost" -Dmcslite.port="80"
deploy:
  provider: s3
  access_key_id: AKIAIMAKZS4RGLFOI2EQ
  secret_access_key:
    secure: jIm59G2eUQ6pvbFlk1KhFrr+4HmM6Y8wFa0Ll3v4hafDCL1dOZdbFXqikb7djdrmQJ6g3XFVOlmMM1SgXUXdCPR3il/2SyFEtuk1DkeAvNDW3OuDkECyS2PwmfT/8lumVamYTNHs9OmKst2Lrh4YwQ89e1zy070jyXer1NW85fBPu7YwwrA5NQA4x8CBtttq096mV0wKZFrendCzM065teKE7KCEc3Dg67pEJpU3ZkV9qr2FKd8JSnRzhhFuFP/3xtzOHIQNXXMizF3hx9rxGKdma+gNh+RqlRec7JoQ9AzAp6MUEIsWVQDTVvLAdRw4gRFResEgZu/EjpgKkdcuapSv8gGLqyvoGO/JpbDBBmlWQWtZtDonRDDRZx8j/z7PheR2y+ZO/lQC0Iy3hijc8oAqO+2LCU7xwQJGuFzSX4RTbY3mMlb/nxskWTWRDmRZ09Cvb6ubJgYd9rAPpFPMmSUzHIQP/G1smeRt7Q3c2guiLTyqmi5NsWHQaaarER4hU72PAc2Kk/GyBOr00VUhO6m8+2eZWSUZCgAbXJOnHC+xgEkXCdoDVO7AcfqGhFqFI3/wzwtlErAqNZbnN5gjO3CrPHeCdEg6r9eohSrtlBtfpiWV5uOb1JsiVNpxBX5mI21KZNETgy52Rn2E2z/wzRplkODtBBT77QF7v/REKQI=
  bucket: mcs-lite-build-bucket
  skip_cleanup: true
  acl: public_read
  region: ap-southeast-1
  local_dir: $TRAVIS_BUILD_DIR/report/
  on:
    all_branches: true
after_deploy:
- cd ./
- chmod 744 parse_result.sh
- sh parse_result.sh || travis_terminate 1;